!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).diff={})}(this,function(e){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function L(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A={SET_ATTRIBUTE:0,REMOVE_ATTRIBUTE:1,NODE_VALUE:2,INSERT_BEFORE:3,REPLACE_CHILD:4,REMOVE_CHILD:5},p=new Map,M=new Map,m=new Map,d=new Set,H=new Set,v=new Set,I=new Set,l=new Set,r=new Set,s=Object.freeze({__proto__:null,StateCache:p,NodeCache:M,TransitionCache:m,MiddlewareCache:d,CreateTreeHookCache:H,CreateNodeHookCache:v,SyncTreeHookCache:I,ReleaseHookCache:l,ParserHookCache:r}),c=new Set,u=new Set,f=new Set,h={free:c,allocated:u,protected:f},g=c.values(),P={size:1e4,memory:h,fill:function(){for(var t=this,e=c.size;e<this.size;e++)c.add({rawNodeName:"",nodeName:"",nodeValue:"",nodeType:1,key:"",childNodes:[],attributes:{}});this.size<c.size&&c.forEach(function(e){c.size!==t.size&&c.delete(e)})},get:function(){var e=g.next(),t=e.value,r=void 0===t?{rawNodeName:"",nodeName:"",nodeValue:"",nodeType:1,key:"",childNodes:[],attributes:{}}:t;return e.done&&(g=c.values()),c.delete(r),u.add(r),r},protect:function(e){u.delete(e),f.add(e)},unprotect:function(e){f.has(e)?(f.delete(e),c.add(e)):u.has(e)&&(u.delete(e),c.add(e))}};P.fill();var D=Array.isArray,z=P.memory,B="#document-fragment",U="#text";function F(r,e,t){var n=null;if(z.protected.has(r)||z.allocated.has(r))n=r;else if(!r||D(r)){var a=r?r.length:0;t=[];for(var o=0;o<a;o++)t.push(r[o]);n=F(B,null,t)}if(n)return n;var i="object"==typeof r,s=r;if(r&&i&&"ownerDocument"in s){var d;if(3===s.nodeType){var l=F(U,s.nodeValue);return M.set(l,r),l}e={},t=[];var c=s.attributes;if(1===s.nodeType&&c&&c.length)for(var u=0;u<c.length;u++){var f=c[u],h=f.name,p=f.value;""===p&&h in s?e[h]=r[h]:e[h]=p}if((1===s.nodeType||11===s.nodeType)&&s.childNodes.length){t=[];for(var v=0;v<s.childNodes.length;v++){var m=s.childNodes[v];t.push(F(m))}}return M.forEach(function(e,t){e===r&&(n=t)}),(n=n||F(s.nodeName,e,t)).attributes=e,n.childNodes.length=0,(d=n.childNodes).push.apply(d,L(t)),M.set(n,r),n}if(i){var g=r.rawNodeName,N=r.nodeName,y=r.nodeValue,b=r.attributes,T=r.childNodes,w=F(g||N,b||null,r.children||T);return y&&(w.nodeValue=y),w}for(var k=arguments.length,E=new Array(3<k?k-3:0),O=3;O<k;O++)E[O-3]=arguments[O];E.length&&(t=[t].concat(E)),n=P.get();var S=r===U,_="string"==typeof r;n.nodeName=_?(n.rawNodeName=r,n.rawNodeName.toLowerCase()):(n.rawNodeName=r,B),n.nodeValue="",n.key="",n.childNodes.length=0,n.attributes={};var C=D(e)||"object"!=typeof e?e:t,x=D(C)?C:[C];if(S){var R=x.join("");return n.nodeType=3,n.nodeValue=String(R||""),n}if(n.nodeName===B?n.nodeType=11:n.nodeType="#comment"===r?8:1,C&&x.length)for(var A=0;A<x.length;A++){var I=x[A];if(D(I)){var V;(V=n.childNodes).push.apply(V,L(I))}else{if(!I)continue;var j;11===I.nodeType&&"string"==typeof I.rawNodeName?(j=n.childNodes).push.apply(j,L(I.childNodes)):I&&"object"==typeof I?n.childNodes.push(F(I)):n.childNodes.push(F(U,null,I))}}return e&&"object"==typeof e&&!D(e)&&(n.attributes=e),"script"===n.nodeName&&n.attributes.src&&(n.key=String(n.attributes.src)),n.attributes&&"key"in n.attributes&&(n.key=String(n.attributes.key)),H.size&&H.forEach(function(e,t){(t=e(n))&&(n=F(t))}),n}var N="undefined"!=typeof process?process:{env:{NODE_ENV:"development"},argv:[]},w="__DIFFHTML__",j=/<!.*>/i,G=new RegExp("".concat(w,"([^_]*)__")),Y={tags:[],attributes:{},children:{}},k=Object.assign,E=Array.isArray,$=["script","noscript","style","code","template"],q=["meta","img","link","input","area","br","hr","area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],J={li:{li:!0},p:{p:!0,div:!0},td:{td:!0,th:!0},th:{td:!0,th:!0}},K={li:{ul:!0,ol:!0},a:{div:!0},b:{div:!0},i:{div:!0},p:{div:!0},td:{tr:!0,table:!0},th:{tr:!0,table:!0}},Q=function(e,t,r){var n;if(!("childNodes"in e.attributes)){if(t&&!j.test(t)&&!G.test(t))return e.childNodes.push(F("#text",t));for(var a=[],o=t.split(G),i=0;i<o.length;i++){var s=o[i];if(s)if(i%2==1){var d=r.children[s],l=s in r.children?d:F("#text","".concat(w).concat(s,"__"));if(!l)continue;var c=11===l.nodeType;"string"==typeof l.rawNodeName&&c?a.push.apply(a,L(l.childNodes)):a.push(l)}else j.test(s)||a.push(F("#text",s))}(n=e.childNodes).push.apply(n,a)}},W=function(e,t,r,n){var a,o=/\b([_a-z][_a-z0-9\-:]*)\s*(=\s*("([^"]+)"|'([^']+)'|(\S+)))?/gi;if(a=G.exec(e))return W(r.tags[a[1]],t,r);for(var i,s={};i=o.exec(t||"");){var d="string"==typeof e,l=i[1],c=i[6]||i[5]||i[4],u=c||(d?i[1]:c||!0),f=String(u).match(G);if(f&&f.length)for(var h=String(u).split(G),p=G.exec(l),v=p?r.attributes[p[1]]:l,m=0;m<h.length;m++){var g=h[m];if(g)if(m%2==1){var N="object"==typeof v,y=r.attributes[g],b="".concat(w).concat(g,"__");s[v]?s[v]+=g in r.attributes?y:b:N?v&&!E(v)&&k(s,v):v&&(s[v]=g in r.attributes?y:b)}else s[v]?s[v]+=g:s[v]=g}else if(f=G.exec(l)){var T=r.attributes[f[1]];"object"!=typeof T||E(T)?s[T]="":k(s,T)}else s[l]="''"===u||'""'===u?"":u}return F(e,s,s.childNodes||[])};function y(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};r.parser||(r.parser={}),t||(t=Y);var n=new Set(r.parser.rawElements?r.parser.rawElements:$),a=new Set(r.parser.selfClosingElements||q),o=/<!--[^]*?(?=-->)-->|<(\/?)([a-z\-\_][a-z0-9\-\_]*)\s*([^>]*?)(\/?)>/gi,i=F("#document-fragment",null,[]),s=[i],d=i,l=-1;if(!e.includes("<")&&e)return Q(d,e,t),i;for(var c,u,f=0;c=o.exec(e);f++){-1<l&&l+c[0].length<o.lastIndex&&(u=e.slice(l,o.lastIndex-c[0].length))&&Q(d,u,t);var h=o.lastIndex-c[0].length;if(-1===l&&0<h){var p=e.slice(0,h);p&&!j.exec(p)&&Q(d,p,t)}if(l=o.lastIndex,"!"!==c[0][1]){var v=G.exec(c[2]),m=v&&t.tags[v[1]],g=m?m.name||m:c[2];if(!c[1]&&(!c[4]&&J[d.rawNodeName]&&J[d.rawNodeName][g]&&(s.pop(),d=s[s.length-1]),d=d.childNodes[d.childNodes.push(W(c[2],c[3],t))-1],s.push(d),r.parser.strict||n.has(g))){var N="</".concat(g,">"),y=e.indexOf(N,o.lastIndex);if(n.has(g)){-1===y?l=o.lastIndex=e.length+1:(l=y+N.length,o.lastIndex=l,c[1]=" ");var b=e.slice(c.index+c[0].length,y);Q(d,b,t)}}if(c[1]||c[4]||a.has(g))for(;d;){if("/"===c[4]&&v){s.pop(),d=s[s.length-1];break}if(m&&d.rawNodeName===g){s.pop(),d=s[s.length-1];break}if(d.rawNodeName===g){s.pop(),d=s[s.length-1];break}var T=K[d.rawNodeName];if(!T||!T[g])break;s.pop(),d=s[s.length-1]}}}var w=e.slice(-1===l?0:l);if(w&&Q(d,w,t),i.childNodes.length&&"html"===i.childNodes[0].nodeName){var k={before:[],after:[]},E={after:[]},O=i.childNodes[0],S=!0,_=!0;if(O.childNodes=O.childNodes.filter(function(e){if("body"===e.nodeName||"head"===e.nodeName)return"head"===e.nodeName&&(S=!1),"body"===e.nodeName&&(_=!1),!0;1===e.nodeType&&(S&&_?k.before.push(e):!S&&_?k.after.push(e):_||E.after.push(e))}),O.childNodes[0]&&"head"===O.childNodes[0].nodeName){var C=O.childNodes[0].childNodes;C.unshift.apply(C,k.before),C.push.apply(C,k.after)}else{var x=F("head",null,[]);if(x){var R=x.childNodes;R.unshift.apply(R,k.before),R.push.apply(R,k.after),O.childNodes.unshift(x)}}if(O.childNodes[1]&&"body"===O.childNodes[1].nodeName){var A=O.childNodes[1].childNodes;A.push.apply(A,E.after)}else{var I=F("body",null,[]);if(I){var V=I.childNodes;V.push.apply(V,E.after),O.childNodes.push(I)}}}return i}var b=P.protect,T=P.unprotect,O=P.memory;function S(e){b(e);for(var t=0;t<e.childNodes.length;t++)S(e.childNodes[t]);return e}function _(e){T(e);for(var t=0;t<e.childNodes.length;t++)_(e.childNodes[t]);return M.delete(e),e}function C(){O.allocated.forEach(function(e){O.free.add(e),O.allocated.delete(e),M.delete(e)})}var x=Object.freeze({__proto__:null,protectVTree:S,unprotectVTree:_,gc:C}),R=new Map,V="diffHTML",X="diff_perf",Z="undefined"!=typeof location,ee=N.argv,te=function(){};function re(a,e){var t=Z&&location.search.includes(X),r=ee&&N.argv.includes(X);if(!(t||r))return te;var o=e;return function(e){var t=a.host;a&&t?e="".concat(t.constructor.name," ").concat(e):o&&"function"==typeof o.rawNodeName&&(e="".concat(o.rawNodeName.name," ").concat(e));var r="".concat(e,"-end");if(R.has(e)){var n=(performance.now()-R.get(e)).toFixed(3);R.delete(e),performance.mark(r),performance.measure("".concat(V," ").concat(e," (").concat(n,"ms)"),e,r)}else R.set(e,performance.now()),performance.mark(e)}}function ne(n){var a=n.state,o=a.isRendering;p.forEach(function(e){var t=e.activeTransaction&&e.activeTransaction.domNode,r=n.domNode;t&&t.contains&&r&&r.contains&&(t.contains(r)&&e.isRendering?(a=e,o=!0):r.contains(t)&&e.isRendering&&(a=e,o=!0))});var e=a,t=e.activeTransaction,r=e.nextTransaction;if(o){var i=n.tasks,s=r||t;(a.nextTransaction=n).abort();var d=s.promise||Promise.resolve();return n.promise=d.then(function(){return n.aborted=!1,n.state.isRendering=!0,n.state.activeTransaction=n,je.flow(n,i.slice(1))})}a.isRendering=!0,a.activeTransaction=n}function ae(e){var t=e.domNode,r=e.markup,n=e.state,a=e.state.measure,o=e.options.inner?"innerHTML":"outerHTML";if(a("should update"),"string"==typeof r&&t[o]===r)return e.abort(!0);"string"==typeof r&&(n.markup=r),a("should update")}function oe(e){var t=p.get(e);if(t&&(p.delete(e),t.oldTree&&!M.has(t.oldTree)&&(_(t.oldTree),l.forEach(function(e){return e(t.oldTree)}))),e){var r=e;if(r.childNodes&&r.childNodes.length)for(var n=0;n<r.childNodes.length;n++)oe(r.childNodes[n]);r.shadowRoot&&oe(r.shadowRoot),M.forEach(function(e,t){e===r&&(_(t),l.forEach(function(e){return e(t)}))})}}function ie(e){var t=e.state,r=e.domNode,n=e.markup,a=e.options,o=t.previousMarkup,i=a.inner,s=r.outerHTML;o===s&&t.oldTree&&s||(oe(r),t.oldTree=F(r),S(t.oldTree),p.set(r,t)),e.newTree||(e.newTree=F(n)),e.oldTree=t.oldTree;var d=e.oldTree,l=e.newTree;if(i&&d&&l){var c=d.nodeName,u=d.attributes,f="string"!=typeof l.rawNodeName,h=11===l.nodeType&&!f?l.childNodes:l;e.newTree=F(c,u,h)}}var se={},de=["old","new"],le="#text";function ce(r,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];r||(r=se),n||(n=se);r.nodeName,11===n.nodeType||r.nodeType;var t=r===se,a=null;if(I.forEach(function(e){var t=e(r,n);t&&t===r?a=!0:t&&(n=t)}),a)return e;for(var o={old:new Map,new:new Map},i=0;i<de.length;i++){var s=o[de[i]],d=arguments[i],l=d&&d.childNodes;if(l&&l.length)for(var c=0;c<l.length;c++){var u=l[c];u.key&&s.set(u.key,u)}}var f=1===n.nodeType;if(n.nodeName===le){if(r.nodeName===le&&r.nodeValue!==n.nodeValue)return e.push(A.NODE_VALUE,r,n.nodeValue,r.nodeValue),r.nodeValue=n.nodeValue,e;if(t)return e.push(A.NODE_VALUE,n,n.nodeValue,null),e}if(f){var h=t?se:r.attributes,p=n.attributes;for(var v in p){var m=p[v];v in h&&h[v]===p[v]||(t||(h[v]=m),e.push(A.SET_ATTRIBUTE,t?n:r,v,m))}if(!t)for(var g in h)g in p||(e.push(A.REMOVE_ATTRIBUTE,r,g),delete h[g])}var N=n.childNodes||[];if(t){for(var y=0;y<N.length;y++)ce(null,N[y],e,n);return e}for(var b=r.childNodes,T=0;T<N.length;T++){var w=b&&b[T],k=N[T],E=k.key;if(w){var O=w.key,S=o.new.has(O),_=o.old.has(E);if(O||E){if(!S&&!_){b.splice(b.indexOf(w),1,k),ce(null,k,e,n),e.push(A.REPLACE_CHILD,k,w),T-=1;continue}if(!S){e.push(A.REMOVE_CHILD,w),b.splice(b.indexOf(w),1),T-=1;continue}if(E!==O){var C=k;E&&_?(C=o.old.get(E),b.splice(b.indexOf(C),1)):C=k,ce(null,C,e,r),e.push(A.INSERT_BEFORE,r,C,w),b.splice(T,0,C);continue}}if(w.nodeName===k.nodeName)ce(w,k,e,r);else{b[T]=k;var x=b.lastIndexOf(k);T<x&&b.splice(x,1),ce(null,k,e,n),e.push(A.REPLACE_CHILD,k,w)}}else b.push(k),ce(null,k,e,r),e.push(A.INSERT_BEFORE,r,k,null)}if(b.length!==N.length){for(var R=N.length;R<b.length;R++)e.push(A.REMOVE_CHILD,b[R]);b.length=N.length}return e}var ue="object"==typeof global?global:window||{},fe=Symbol.for("diffHTML"),he="http://www.w3.org/2000/svg",pe=ue.document||null;function ve(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:pe,r=2<arguments.length?arguments[2]:void 0,n=F(e),a=M.get(n);if(a)return a;var o=n.nodeName,i=n.rawNodeName,s=void 0===i?o:i,d=n.childNodes,l=void 0===d?[]:d;r=r||"svg"===o;var c=null;v.forEach(function(e,t){(t=e(n))&&(c=t)}),null===c&&(c="#text"===o?t.createTextNode(n.nodeValue||""):"#document-fragment"===o?t.createDocumentFragment():r?t.createElementNS(he,s):t.createElement(s));var u=c;M.set(n,u);for(var f=0;f<l.length;f++){var h=ve(l[f],t,r);u.appendChild(h)}return u}function me(e){var t=e.state.measure,r=e.oldTree,n=e.newTree,a=e.domNode;t("sync trees"),r&&n&&r.nodeName!==n.nodeName&&11!==n.nodeType?(e.patches=[A.REPLACE_CHILD,n,r],e.oldTree=e.state.oldTree=n,p.delete(a),p.set(ve(n),e.state)):e.patches=ce(r||null,n||null,[]),t("sync trees")}var ge=["attached","detached","replaced","attributeChanged","textChanged"];function Ne(e,t){m.get(e).add(t)}function ye(e,t){if(!t&&e)m.get(e).clear();else if(e&&t)m.get(e).delete(t);else for(var r=0;r<ge.length;r++)m.get(ge[r]).clear()}function be(t){for(var e=m.get(t),r=[],n=arguments.length,a=new Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];var i=a[0],s=a.slice(1);return!e.size||"textChanged"!==t&&1!==i.nodeType||(e.forEach(function(e){var t=e.apply(void 0,[M.get(i)].concat(L(s)));"object"==typeof t&&t.then&&r.push(t)}),"attached"!==t&&"detached"!==t||i.childNodes.forEach(function(e){r.push.apply(r,L(be.apply(void 0,[t,e].concat(L(s)))))})),r}ge.forEach(function(e){return m.set(e,new Set)});var Te=ue.document?document.createElement("div"):null;function we(e){return Te&&e&&e.indexOf&&e.includes("&")?(Te.innerHTML=e,Te.textContent||""):e}var ke=Object.keys,Ee=new Set,Oe=new Set,Se=["class","checked","disabled","selected"],_e=function(e,t,r,n){var a="object"==typeof n&&n,o="function"==typeof n,i="symbol"==typeof n,s=0===r.indexOf("on")?r.toLowerCase():r,d=e.nodeName+"-"+s,l=t;if(Oe.has(d))t[s]=n;else if(!Ee.has(d))try{t[s]=n,Oe.add(d)}catch(e){Ee.add(d)}if(a||o||i){if(a&&"style"===s)for(var c=ke(n),u=0;u<c.length;u++)l.style[c[u]]=n[c[u]]}else{var f=null==n;s&&l.setAttribute(s,f?"":n)}},Ce=function(e,t){var r=0===t.indexOf("on");e.removeAttribute(t);var n=e.nodeName+"-"+t;if(Oe.has(n)){var a=e;r?a[t]=void 0:delete a[t],Se.includes(t)&&(e[t]=!1)}else if(!Ee.has(n))try{var o=e;r?o[t]=void 0:delete o[t],Se.includes(t)&&(e[t]=!1),Oe.add(n)}catch(e){Ee.add(n)}},xe=function(e,t){var r=e;t.includes("&")?r.nodeValue=we(t):r.nodeValue=t};function Re(e){var t=e.domNode,r=e.state,n=e.state.measure,a=e.patches,o=t.nodeName,i=t.namespaceURI,s=t.ownerDocument,d=e.promises||[],l=i||"";r.isSVG="svg"===o.toLowerCase()||l.includes("svg"),r.ownerDocument=s||document,n("patch node"),d.push.apply(d,L(function(u){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f=[],h=e.isSVG,p=e.ownerDocument,t=u.length,v=0;;){var r=u[v];if(v===t)break;switch(r){case A.SET_ATTRIBUTE:if("break"===function(){var e=u[v+1],t=u[v+2],r=we(u[v+3]);v+=4;var n=ve(e,p,h),a=n.getAttribute(t),o=be("attributeChanged",e,t,a,r);return S(e),o.length?(Promise.all(o).then(function(){return _e(e,n,t,r)}),f.push.apply(f,L(o))):_e(e,n,t,r),"break"}())break;case A.REMOVE_ATTRIBUTE:if("break"===function(){var e=u[v+1],t=u[v+2];v+=3;var r=ve(e,p,h),n=r.getAttribute(t),a=be("attributeChanged",e,t,n,null);return S(e),a.length?(Promise.all(a).then(function(){return Ce(r,t)}),f.push.apply(f,L(a))):Ce(r,t),"break"}())break;case A.NODE_VALUE:if("break"===function(){var e=u[v+1],t=u[v+2],r=u[v+3];v+=4;var n=ve(e,p,h);S(e);var a=be("textChanged",e,r,t);return a.length?(Promise.all(a).then(function(){return xe(n,t)}),f.push.apply(f,L(a))):xe(n,t),"break"}())break;case A.INSERT_BEFORE:var n=u[v+1],a=u[v+2],o=u[v+3];v+=4;var i=M.get(n);if(!i)break;S(a);var s=o&&ve(o,p,h),d=ve(a,p,h);i.insertBefore(d,s||null),f.push.apply(f,L(be("attached",a)));break;case A.REPLACE_CHILD:if("break"===function(){var e=u[v+1],t=u[v+2];v+=3;var r=M.get(t),n=ve(e,p,h);if(!r||!r.parentNode)return"break";S(e);var a=m.get("attached").size,o=m.get("detached").size,i=m.get("replaced").size;if(!a&&!o&&!i)return r.parentNode&&(_(t),r.parentNode.replaceChild(n,r)),"break";r.parentNode&&r.parentNode.insertBefore(n,r);var s=be("attached",e),d=be("detached",t),l=be("replaced",t,n),c=[].concat(L(s),L(d),L(l));return c.length?(Promise.all(c).then(function(){r.parentNode&&r.parentNode.removeChild(r),_(t)}),f.push.apply(f,L(c))):(r.parentNode&&r.parentNode.removeChild(r),_(t)),"break"}())break;case A.REMOVE_CHILD:if("break"===function(){var e=u[v+1];v+=2;var t=M.get(e);if(!t||!t.parentNode)return"break";var r=be("detached",e);return r.length?(Promise.all(r).then(function(){t.parentNode&&t.parentNode.removeChild(t),_(e)}),f.push.apply(f,L(r))):(t.parentNode&&t.parentNode.removeChild(t),_(e)),"break"}())break}}return f}(a,r))),n("patch node"),e.promises=d}function Ae(e){var t=e.promises;return t&&t.length?e.promise=Promise.all(t).then(function(){return e.end()}):e.promise=Promise.resolve(e.end())}var Ie=[ne,ae,ie,me,Re,Ae],Ve={schedule:ne,shouldUpdate:ae,reconcileTrees:ie,syncTrees:me,patchNode:Re,endAsPromise:Ae},je=function(){function n(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),a(this,"domNode",""),a(this,"markup",""),a(this,"oldTree",void 0),a(this,"newTree",void 0),a(this,"promise",void 0),a(this,"promises",void 0),a(this,"tasks",[]),a(this,"patches",[]),this.domNode=e,this.markup=t,this.options=r,this.state=p.get(e)||{measure:re(e,t)},r.tasks&&r.tasks.length&&(this.tasks=L(r.tasks)),this.endedCallbacks=new Set,p.set(e,this.state)}return t(n,null,[{key:"create",value:function(e,t,r){return new n(e,t,r)}},{key:"flow",value:function(e,t){for(var r=e,n=0;n<t.length;n++){if(e.aborted)return r;if(void 0!==(r=t[n](e))&&r!==e)return r}return r}},{key:"assert",value:function(e){}},{key:"invokeMiddleware",value:function(r){var n=r.tasks;d.forEach(function(e){var t=e(r);t&&n.push(t)})}}]),t(n,[{key:"start",value:function(){var e=this.state.measure,t=this.tasks,r=t.pop();return this.aborted=!1,n.invokeMiddleware(this),e("render"),r&&t.push(r),n.flow(this,t)}},{key:"abort",value:function(e){if(this.aborted=!0,e)return this.tasks[this.tasks.length-1](this)}},{key:"end",value:function(){var t=this,e=this.state,r=this.domNode,n=e.measure;return n("finalize"),this.completed=!0,n("finalize"),n("render"),e.previousMarkup="outerHTML"in r?r.outerHTML:"",e.isRendering=!1,C(),this.endedCallbacks.forEach(function(e){return e(t)}),this.endedCallbacks.clear(),this}},{key:"onceEnded",value:function(e){this.endedCallbacks.add(e)}}]),n}();function Le(e){return e.replace(/[&<>]/g,function(e){return"&#".concat(e.charCodeAt(0),";")})}var Me=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){a(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({decodeEntities:we,escape:Le,makeMeasure:re,memory:x,Pool:P,process:N,PATCH_TYPE:A,createNode:ve,syncTree:ce},s);function He(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return r.inner=!0,r.tasks=r.tasks||Ie,je.create(e,t,r).start()}function Pe(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return r.inner=!1,r.tasks=r.tasks||Ie,je.create(e,t,r).start()}var De=Array.isArray,ze=/(<|\/)/,Be=function(e){var t=e.shift();return"string"==typeof t?Le(we(t)):t};function Ue(e){for(var t=arguments.length,l=new Array(1<t?t-1:0),r=1;r<t;r++)l[r-1]=arguments[r];var n=F("#text","");if(!e)return n;if("string"==typeof e&&(e=[e]),1===e.length&&!l.length){var a=Ue.isStrict;if(Ue.isStrict=!1,!e[0])return n;var o=y(e[0],void 0,{parser:{strict:a}}).childNodes;return F(1===o.length?o[0]:o)}var c="",u={attributes:{},children:{},tags:{}};e.forEach(function(e,t){if(c+=e,l.length){var r=Be(l),n=c.trim().slice(-1),a=c.lastIndexOf(">")<c.lastIndexOf("<"),o=Boolean(n.match(ze)),i="string"==typeof r,s="object"==typeof r,d="".concat(w).concat(t,"__");o&&!i?(u.tags[t]=r,c+=d):a?(u.attributes[t]=r,c+=d):De(r)||s?(u.children[t]=F(r),c+=d):r&&(c+=r)}});var i=Ue.isStrict;Ue.isStrict=!1;var s=y(c,u,{parser:{strict:i}}).childNodes;return F(1===s.length?s[0]:s)}function Fe(e){var t="function"==typeof e,r=e.subscribe,n=e.unsubscribe,a=e.createTreeHook,o=e.createNodeHook,i=e.syncTreeHook,s=e.releaseHook;return t&&d.add(e),r&&r(Me),a&&H.add(a),o&&v.add(o),i&&I.add(i),s&&l.add(s),function(){t&&d.delete(e),n&&n(Me),H.delete(a),v.delete(o),I.delete(i),l.delete(s)}}Ue.isStrict=!1,Ue.strict=function(e){Ue.isStrict=!0;for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Ue.apply(void 0,[e].concat(r))};var Ge="1.0.0-beta.16",Ye=Object.assign;Ie.splice(Ie.indexOf(ie),0,function(e){var t=e.state,r=e.markup,n=e.options,a=t.measure,o=n.inner;if("string"==typeof r){a("parsing markup for new tree");var i=y(r,void 0,n).childNodes,s=F(o?i:i[0]||i);s&&(e.newTree=s),a("parsing markup for new tree")}}),Ye(Me,{parse:y,defaultTasks:Ie,tasks:Ve,VERSION:Ge});var $e={};$e.VERSION=Ge,$e.addTransitionState=Ne,$e.removeTransitionState=ye,$e.release=oe,$e.createTree=F,$e.use=Fe,$e.outerHTML=Pe,$e.innerHTML=He,$e.html=Ue,$e.Internals=Me;var qe=ue;fe in ue?Ye($e,qe[fe]):(qe[fe]=$e,qe.devTools&&(qe.unsubscribeDevTools=Fe(qe.devTools(Me)))),e.Internals=Me,e.VERSION=Ge,e.addTransitionState=Ne,e.createTree=F,e.default=$e,e.html=Ue,e.innerHTML=He,e.outerHTML=Pe,e.release=oe,e.removeTransitionState=ye,e.use=Fe,Object.defineProperty(e,"__esModule",{value:!0})});