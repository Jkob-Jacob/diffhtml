# <Â±/> diffHTML

*The core diffHTML library. Parses HTML, reconciles changes, and keeps the DOM in sync.*

Stable version: 1.0.0-beta.10

Inspired by React and motivated by the Web, this library is designed to help
developers write components and applications using HTML. By focusing on the
markup representing how your state should look, diffHTML will figure out how to
modify the page with a minimal amount of operations.

## Quick Jump

- [How to install](#how-to-install)
  - [CDN](#user-content-cdn)
  - [Include in HTML (Browser)](#user-content-include-in-html-with-a-local-file)
  - [Require with CommonJS (Node)](#user-content-require-with-commonjs-node)
  - [Import using ES Modules syntax (Advanced usage)](#user-content-import-using-es-modules-syntax-advanced-usage)
  - [Module format locations](#user-content-module-format-locations)
- [API](#user-content-api)
  - **[innerHTML(element, markup, options)](#user-content-diff-an-elements-children-with-markup)**
  - **[outerHTML(element, markup, options)](#user-content-diff-an-element-with-markup)**
  - **[html\`tagged template helper\`](#user-content-html)**
  - [createTree(nodeName, attributes, children)](#user-content-create-tree)
  - [release(element)](#user-content-release-element)
  - [addTransitionState(name, callback)](#user-content-add-a-transition-state-callback)
  - [removeTransitionState(name, callback)](#user-content-remove-a-transition-state-callback)
  - [use(middleware)](#use)
  - [Internals](#internals)

## How to install

[Back to quick jump...](#quick-jump)

There are a few ways to get diffHTML. You can use native browser ESM imports
and load from a CDN or locally. Install it through a package manager like npm.

### CDN

[Back to quick jump...](#quick-jump)

The latest build is provided at
[//diffhtml.org/es](https://diffhtml.org/es). You can also get it from
[//unpkg.com/diffhtml/dist/es](https://unpkg.com/diffhtml/dist/es) which will
work the exact same way.

```html
<script type="module">
  import { innerHTML } from 'https://diffhtml.org/es';

  innerHTML(document.body, '<span>Hello world</span>');
</script>
```

You can drop the protocol and use `//` if you serve from http or https, if
you're using a local `file://` you will need to specify the `https`.

```js
import { innerHTML } from '//unpkg.com/diffhtml/dist/es';
```

The latest built version (but not necessarily the latest stable) is available
for quick download from the [master
branch](https://raw.githubusercontent.com/tbranyen/diffhtml/master/packages/diffhtml/dist/diffhtml.js).
Use this to test the bleeding edge.

Or you can use npm:

``` sh
npm install diffhtml --save
```

or using yarn:

``` sh
yarn add diffhtml
```

The module can be included natively in Node or browser environments. It is
exported as a global named `diff` unless loaded as a module, in which case you
determine the name diffHTML will be assigned to.

### Include in HTML with a local file

[Back to quick jump...](#quick-jump)

The path of least resistance to trying out diffHTML. Simply drop a script
into your markup and `diff` will be available for your code to start utilizing
its benefits.

``` html
<script src="node_modules/diffhtml/dist/diffhtml.js"></script>

<script>
  // Use a block to keep variables out of the global scope.
  {
    const { innerHTML } = diff;

    innerHTML(document.body, '<span>Hello world!</span>');
  }
</script>
```

### Require with CommonJS (Node)

[Back to quick jump...](#quick-jump)

Node is built using the CommonJS pattern as this predates ES Modules by years,
if you are consuming diffHTML inside Node, it is recommended to use this method
of importing.

``` javascript
const { innerHTML } = require('diffhtml');

innerHTML(document.body, '<span>Hello world!</span>');
```

You can import only what you need if you're using ES Modules:


### Import using ES Modules syntax (Advanced usage)

[Back to quick jump...](#quick-jump)

Useful for those who are building applications using the next-generation syntax
for defining modules. diffHTML is fully compatible with ES Modules and will
continue to improve supporting techniques benefiting from this format, such as
tree shaking.

``` javascript
import { innerHTML } from 'diffhtml';

innerHTML(document.body, '<span>Hello world!</span>');
```

### Module format locations

[Back to quick jump...](#quick-jump)

This library is authored in vanilla ES Modules with no experimental syntax
enabled. The CJS build is compiled with Babel to reduce `import` calls to
`require`. The UMD build is generated by Rollup to ES5.

| Format                   | Specification | Location
| ------------------------ | ------------- | ---------------------------
| UMD (AMD/CJS/Browser)    | ES5           | `diffhtml/dist/diffhtml.js`
| CJS                      | ES6           | `diffhtml/dist/cjs/*`
| ESM (ES Modules)         | ES6           | `diffhtml/dist/es/*`

## Documentation

[Back to quick jump...](#quick-jump)

### Lifecycle overview

[Back to quick jump...](#quick-jump)

The following outlines the lifecycle flow of diffHTML rendering. The tasks that
follow occur after something triggers an `innerHTML` or `outerHTML` call.

#### Schedule

The first task that runs is scheduling or deferring the transaction that was
created by the `innerHTML` or `outerHTML` call. diffHTML is a shared namespace
and will only allow one render at a time.  If a render is happening during this
time, then the transaction will be deferred by scheduling it for later
processing.

#### Should update

This looks at the markup passed in and checks if it matches with the markup
passed before. If nothing has changed, then it will abort the transaction.

#### Reconcile trees



#### Synchronize trees

#### Patch node

#### End as Promise

### Virtual Tree Abstraction

[Back to quick jump...](#quick-jump)

### Middleware

[Back to quick jump...](#quick-jump)

#### Writing

[Back to quick jump...](#quick-jump)

#### Consuming

[Back to quick jump...](#quick-jump)

#### Building the input Virtual Tree

[Back to quick jump...](#quick-jump)

#### Invoking Middleware

[Back to quick jump...](#quick-jump)

#### Synchronizing the input tree into the original tree

[Back to quick jump...](#quick-jump)

#### Patching the DOM Node

[Back to quick jump...](#quick-jump)

#### Asynchronous transitions

[Back to quick jump...](#quick-jump)

#### Completing the render transaction

[Back to quick jump...](#quick-jump)

## API

[Back to quick jump...](#quick-jump)

### innerHTML

[Back to quick jump...](#quick-jump)

This method also takes in a string of markup, but unlike `outerHTML` this is
children-only markup that will be nested inside the element passed.

You cannot override the `inner` options property here.


``` javascript
diff.innerHTML(document.body, '<h1>Hello world!</h1>');
```

### outerHTML

[Back to quick jump...](#quick-jump)

This method will take in a string of markup that matches the element root you
are diffing against.  This allows you to change attributes and text on the
main element.  This also allows you to change the `document.documentElement`.

You cannot override the `inner` options property here.


``` javascript
diff.outerHTML(document.body, '<body class="test"><h1>Hello world!</h1></body>');
```

### html

[Back to quick jump...](#quick-jump)

Takes in HTML string input and produces a Virtual Tree that is usable by
diffHTML. This works identical to React's JSX model.

#### Options

[Back to quick jump...](#quick-jump)

This is an optional argument that can be passed to any diff method. The `inner`
property can only be used with the element method.

- `inner` - Boolean that determines if `innerHTML` is used.

### Error types

The follow error types are exposed so you can test exceptions:

- `TransitionStateError` - Happens when errors occur during transitions.
- `DOMException` - Happens when DOM manipulation fails.

[More information and a demo are available on http://www.diffhtml.org/](http://www.diffhtml.org/)
